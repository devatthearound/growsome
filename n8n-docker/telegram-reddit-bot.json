{
  "name": "Telegram Reddit Insights Bot",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "telegram-webhook",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "telegram-webhook",
      "name": "Telegram Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "webhookId": "telegram-reddit-bot"
    },
    {
      "parameters": {
        "jsCode": "// Telegram Î©îÏãúÏßÄ ÌååÏã±\nconst update = $input.all()[0].json;\n\nif (!update.message) {\n  return [];\n}\n\nconst message = update.message;\nconst chatId = message.chat.id;\nconst text = message.text || '';\nconst username = message.from.username || message.from.first_name;\n\n// Î™ÖÎ†πÏñ¥ Ï≤òÎ¶¨\nconst commands = {\n  '/start': 'Î†àÎîß Ïù∏ÏÇ¨Ïù¥Ìä∏ Î¥áÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§!\\n\\nÏÇ¨Ïö© Í∞ÄÎä•Ìïú Î™ÖÎ†πÏñ¥:\\n/insights - ÏµúÏã† ÎπÑÏ¶àÎãàÏä§ Ïù∏ÏÇ¨Ïù¥Ìä∏ Î∂ÑÏÑù\\n/help - ÎèÑÏõÄÎßê Î≥¥Í∏∞',\n  '/insights': 'insights',\n  '/help': 'ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Î™ÖÎ†πÏñ¥:\\n\\n/start - ÏãúÏûëÌïòÍ∏∞\\n/insights - Î†àÎîß ÎπÑÏ¶àÎãàÏä§ Ïù∏ÏÇ¨Ïù¥Ìä∏ Î∂ÑÏÑù\\n/help - Ïù¥ ÎèÑÏõÄÎßê Î≥¥Í∏∞\\n\\nÎ¥áÏù¥ RedditÏóêÏÑú ÎπÑÏ¶àÎãàÏä§ Í¥ÄÎ†® Ìè¨Ïä§Ìä∏Î•º ÏàòÏßëÌïòÍ≥† AIÎ°ú Î∂ÑÏÑùÌïòÏó¨ ÎπÑÏ¶àÎãàÏä§ Í∏∞ÌöåÎ•º Ï∞æÏïÑÎìúÎ¶ΩÎãàÎã§.',\n};\n\nconst response = {\n  chatId: chatId,\n  command: text.toLowerCase(),\n  username: username,\n  message: commands[text.toLowerCase()] || 'Ïïå Ïàò ÏóÜÎäî Î™ÖÎ†πÏñ¥ÏûÖÎãàÎã§. /helpÎ•º ÏûÖÎ†•ÌïòÏó¨ ÏÇ¨Ïö©Î≤ïÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.'\n};\n\nreturn [{ json: response }];"
      },
      "id": "parse-command",
      "name": "Parse Command",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "command-check",
              "leftValue": "={{ $json.command }}",
              "rightValue": "insights",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "check-insights-command",
      "name": "Check Insights Command",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [680, 300]
    },
    {
      "parameters": {
        "url": "https://n8n.growsome.kr/webhook/reddit-insights",
        "options": {
          "timeout": 60000
        }
      },
      "id": "trigger-insights-workflow",
      "name": "Trigger Insights Workflow",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [900, 200],
      "credentials": {
        "httpBasicAuth": [],
        "httpHeaderAuth": [],
        "httpDigestAuth": [],
        "oAuth2": [],
        "httpQueryAuth": []
      }
    },
    {
      "parameters": {
        "jsCode": "// Ïù∏ÏÇ¨Ïù¥Ìä∏ Í≤∞Í≥ºÎ•º Telegram Î©îÏãúÏßÄÎ°ú Î≥ÄÌôò\nconst insightsResult = $input.all()[0].json;\nconst chatId = $('Parse Command').first().json.chatId;\n\nlet message = 'üîç *Î†àÎîß ÎπÑÏ¶àÎãàÏä§ Ïù∏ÏÇ¨Ïù¥Ìä∏ Î∂ÑÏÑù Í≤∞Í≥º*\\n\\n';\n\nif (insightsResult.summary) {\n  message += `üìä *Î∂ÑÏÑù ÏöîÏïΩ*\\n`;\n  message += `‚Ä¢ Î∂ÑÏÑùÎêú Ìè¨Ïä§Ìä∏: ${insightsResult.summary.total_posts_analyzed}Í∞ú\\n`;\n  message += `‚Ä¢ Î∞úÍ≤¨Îêú Í∏∞Ìöå: ${insightsResult.summary.top_opportunities_count}Í∞ú\\n\\n`;\n}\n\nif (insightsResult.insights && insightsResult.insights.top_opportunities) {\n  message += `üí° *Ï£ºÏöî ÎπÑÏ¶àÎãàÏä§ Í∏∞Ìöå*\\n\\n`;\n  insightsResult.insights.top_opportunities.forEach((opportunity, index) => {\n    message += `${index + 1}. ${opportunity.title || 'Í∏∞Ìöå Ï†úÎ™©'}\\n`;\n    if (opportunity.description) {\n      message += `   ${opportunity.description.substring(0, 100)}...\\n\\n`;\n    }\n  });\n}\n\nif (insightsResult.recommendations && insightsResult.recommendations.immediate_actions) {\n  message += `‚ö° *Ï¶âÏãú Ïã§Ìñâ Í∞ÄÎä•Ìïú Ïï°ÏÖò*\\n\\n`;\n  insightsResult.recommendations.immediate_actions.slice(0, 3).forEach((action, index) => {\n    message += `${index + 1}. ${action}\\n`;\n  });\n}\n\nmessage += '\\nüìà ÏûêÏÑ∏Ìïú Î∂ÑÏÑù Í≤∞Í≥ºÎäî Google SheetsÏóêÏÑú ÌôïÏù∏ÌïòÏÑ∏Ïöî.';\n\nreturn [{ json: { chatId: chatId, message: message } }];"
      },
      "id": "format-insights-response",
      "name": "Format Insights Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1120, 200]
    },
    {
      "parameters": {
        "url": "https://api.telegram.org/bot{{ $env.TELEGRAM_BOT_TOKEN }}/sendMessage",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "chat_id",
              "value": "={{ $json.chatId }}"
            },
            {
              "name": "text",
              "value": "={{ $json.message }}"
            },
            {
              "name": "parse_mode",
              "value": "Markdown"
            }
          ]
        },
        "options": {
          "timeout": 10000
        }
      },
      "id": "send-telegram-response",
      "name": "Send Telegram Response",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1340, 200],
      "credentials": {
        "httpBasicAuth": [],
        "httpHeaderAuth": [],
        "httpDigestAuth": [],
        "oAuth2": [],
        "httpQueryAuth": []
      }
    },
    {
      "parameters": {
        "url": "https://api.telegram.org/bot{{ $env.TELEGRAM_BOT_TOKEN }}/sendMessage",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "chat_id",
              "value": "={{ $json.chatId }}"
            },
            {
              "name": "text",
              "value": "={{ $json.message }}"
            },
            {
              "name": "parse_mode",
              "value": "Markdown"
            }
          ]
        },
        "options": {
          "timeout": 10000
        }
      },
      "id": "send-default-response",
      "name": "Send Default Response",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [900, 400],
      "credentials": {
        "httpBasicAuth": [],
        "httpHeaderAuth": [],
        "httpDigestAuth": [],
        "oAuth2": [],
        "httpQueryAuth": []
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, message: 'Telegram bot response sent' } }}",
        "options": {}
      },
      "id": "webhook-response",
      "name": "Webhook Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1560, 200]
    }
  ],
  "connections": {
    "Telegram Webhook": {
      "main": [
        [
          {
            "node": "Parse Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Command": {
      "main": [
        [
          {
            "node": "Check Insights Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Insights Command": {
      "main": [
        [
          {
            "node": "Trigger Insights Workflow",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Trigger Insights Workflow": {
      "main": [
        [
          {
            "node": "Format Insights Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Insights Response": {
      "main": [
        [
          {
            "node": "Send Telegram Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Telegram Response": {
      "main": [
        [
          {
            "node": "Webhook Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Insights Command": {
      "main": [
        [
          {
            "node": "Send Default Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Default Response": {
      "main": [
        [
          {
            "node": "Webhook Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2024-01-01T00:00:00.000Z",
      "updatedAt": "2024-01-01T00:00:00.000Z",
      "id": "telegram-reddit-bot",
      "name": "telegram-reddit-bot"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2024-01-01T00:00:00.000Z",
  "versionId": "1"
} 