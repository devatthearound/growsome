<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Database Debug</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            background: #f8f9fa;
        }
        .debug-section {
            background: white;
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .debug-title {
            color: #333;
            margin-bottom: 1rem;
        }
        .debug-output {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            font-family: Monaco, Consolas, monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #007bff; }
        button {
            background: #514FE4;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 0.5rem 0.5rem 0 0;
        }
        button:hover {
            background: #4338ca;
        }
        .post-link {
            display: inline-block;
            background: #e9ecef;
            padding: 0.5rem 1rem;
            margin: 0.25rem 0;
            border-radius: 4px;
            text-decoration: none;
            color: #495057;
            border: 1px solid #ced4da;
        }
        .post-link:hover {
            background: #dee2e6;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Blog Database Debug Tool</h1>
    <p>ì´ ë„êµ¬ëŠ” ë¸”ë¡œê·¸ ì‹œìŠ¤í…œì˜ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ê³¼ ë°ì´í„°ë¥¼ í™•ì¸í•˜ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤.</p>

    <div class="debug-section">
        <h2 class="debug-title">ğŸš€ ë¹ ë¥¸ ì§„ë‹¨</h2>
        <button onclick="runFullDiagnostic()">ì „ì²´ ì§„ë‹¨ ì‹¤í–‰</button>
        <button onclick="clearOutput()">ì¶œë ¥ ì§€ìš°ê¸°</button>
        <div id="fullDiagnostic" class="debug-output"></div>
    </div>

    <div class="debug-section">
        <h2 class="debug-title">ğŸ“‹ í¬ìŠ¤íŠ¸ ëª©ë¡ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testPostsList()">í¬ìŠ¤íŠ¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°</button>
        <div id="postsOutput" class="debug-output"></div>
    </div>

    <div class="debug-section">
        <h2 class="debug-title">ğŸ“„ ê°œë³„ í¬ìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testSinglePost()">ì²« ë²ˆì§¸ í¬ìŠ¤íŠ¸ ìƒì„¸ ì •ë³´</button>
        <div id="singlePostOutput" class="debug-output"></div>
    </div>

    <div class="debug-section">
        <h2 class="debug-title">ğŸ·ï¸ ì¹´í…Œê³ ë¦¬ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testCategories()">ì¹´í…Œê³ ë¦¬ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°</button>
        <div id="categoriesOutput" class="debug-output"></div>
    </div>

    <div class="debug-section">
        <h2 class="debug-title">ğŸ”— ìœ íš¨í•œ ë§í¬ë“¤</h2>
        <div id="validLinks"></div>
    </div>

    <script>
        let postsData = null;

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const emoji = {
                'success': 'âœ…',
                'error': 'âŒ',
                'warning': 'âš ï¸',
                'info': 'â„¹ï¸'
            };
            
            return `${emoji[type]} [${timestamp}] ${message}\n`;
        }

        function output(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent += message;
            element.scrollTop = element.scrollHeight;
        }

        function clearOutput() {
            ['fullDiagnostic', 'postsOutput', 'singlePostOutput', 'categoriesOutput'].forEach(id => {
                document.getElementById(id).textContent = '';
            });
            document.getElementById('validLinks').innerHTML = '';
        }

        async function testPostsList() {
            const outputId = 'postsOutput';
            document.getElementById(outputId).textContent = '';
            
            output(outputId, log('í¬ìŠ¤íŠ¸ ëª©ë¡ API í…ŒìŠ¤íŠ¸ ì‹œì‘...'));
            
            try {
                const response = await fetch('/api/blog/posts');
                output(outputId, log(`ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`));
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                postsData = data; // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
                
                output(outputId, log('API ì‘ë‹µ ì„±ê³µ!', 'success'));
                output(outputId, log(`ì‘ë‹µ ë°ì´í„°: ${JSON.stringify(data, null, 2)}`));
                
                if (data.success && data.posts && data.posts.length > 0) {
                    output(outputId, log(`ë°œê²¬ëœ í¬ìŠ¤íŠ¸ ìˆ˜: ${data.posts.length}`, 'success'));
                    
                    // UUID ê²€ì¦
                    const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
                    data.posts.forEach((post, index) => {
                        const isValidUUID = uuidRegex.test(post.id);
                        output(outputId, log(`í¬ìŠ¤íŠ¸ ${index + 1}: "${post.title}" - ID: ${post.id} ${isValidUUID ? '(ìœ íš¨í•œ UUID)' : '(ìœ íš¨í•˜ì§€ ì•Šì€ UUID)'}`, isValidUUID ? 'success' : 'error'));
                    });
                    
                    updateValidLinks(data.posts);
                } else {
                    output(outputId, log('í¬ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'warning'));
                }
                
            } catch (error) {
                output(outputId, log(`ì˜¤ë¥˜: ${error.message}`, 'error'));
            }
        }

        async function testSinglePost() {
            const outputId = 'singlePostOutput';
            document.getElementById(outputId).textContent = '';
            
            if (!postsData || !postsData.posts || postsData.posts.length === 0) {
                output(outputId, log('ë¨¼ì € í¬ìŠ¤íŠ¸ ëª©ë¡ì„ ê°€ì ¸ì™€ì•¼ í•©ë‹ˆë‹¤', 'warning'));
                return;
            }
            
            const firstPost = postsData.posts[0];
            output(outputId, log(`ì²« ë²ˆì§¸ í¬ìŠ¤íŠ¸ IDë¡œ ìƒì„¸ ì •ë³´ í…ŒìŠ¤íŠ¸: ${firstPost.id}`));
            
            try {
                const response = await fetch(`/api/blog/posts/${firstPost.id}`);
                output(outputId, log(`ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`));
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                output(outputId, log('ìƒì„¸ í¬ìŠ¤íŠ¸ API ì„±ê³µ!', 'success'));
                output(outputId, log(`ìƒì„¸ ë°ì´í„°: ${JSON.stringify(data, null, 2)}`));
                
                if (data.success && data.post) {
                    output(outputId, log(`í¬ìŠ¤íŠ¸ ì œëª©: "${data.post.title}"`, 'success'));
                    output(outputId, log(`í¬ìŠ¤íŠ¸ ID: ${data.post.id}`, 'success'));
                    output(outputId, log(`ì˜¬ë°”ë¥¸ URL: /blog/${data.post.id}`, 'success'));
                }
                
            } catch (error) {
                output(outputId, log(`ì˜¤ë¥˜: ${error.message}`, 'error'));
            }
        }

        async function testCategories() {
            const outputId = 'categoriesOutput';
            document.getElementById(outputId).textContent = '';
            
            output(outputId, log('ì¹´í…Œê³ ë¦¬ API í…ŒìŠ¤íŠ¸ ì‹œì‘...'));
            
            try {
                const response = await fetch('/api/blog/categories');
                output(outputId, log(`ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`));
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                output(outputId, log('ì¹´í…Œê³ ë¦¬ API ì„±ê³µ!', 'success'));
                output(outputId, log(`ì¹´í…Œê³ ë¦¬ ë°ì´í„°: ${JSON.stringify(data, null, 2)}`));
                
                if (data.success && data.categories) {
                    output(outputId, log(`ë°œê²¬ëœ ì¹´í…Œê³ ë¦¬ ìˆ˜: ${data.categories.length}`, 'success'));
                    data.categories.forEach((category, index) => {
                        output(outputId, log(`ì¹´í…Œê³ ë¦¬ ${index + 1}: "${category.name}" - ID: ${category.id}`));
                    });
                }
                
            } catch (error) {
                output(outputId, log(`ì˜¤ë¥˜: ${error.message}`, 'error'));
            }
        }

        function updateValidLinks(posts) {
            const linksContainer = document.getElementById('validLinks');
            if (posts && posts.length > 0) {
                linksContainer.innerHTML = '<h3>ğŸ”— í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ” ìœ íš¨í•œ ë§í¬ë“¤:</h3>';
                posts.forEach((post, index) => {
                    const link = document.createElement('a');
                    link.href = `/blog/${post.id}`;
                    link.className = 'post-link';
                    link.textContent = `${index + 1}. ${post.title} (ID: ${post.id})`;
                    link.target = '_blank';
                    linksContainer.appendChild(link);
                    linksContainer.appendChild(document.createElement('br'));
                });
            }
        }

        async function runFullDiagnostic() {
            const outputId = 'fullDiagnostic';
            document.getElementById(outputId).textContent = '';
            
            output(outputId, log('=== ì „ì²´ ì‹œìŠ¤í…œ ì§„ë‹¨ ì‹œì‘ ===', 'info'));
            
            // 1. í˜„ì¬ ìœ„ì¹˜ í™•ì¸
            output(outputId, log(`í˜„ì¬ URL: ${window.location.href}`));
            output(outputId, log(`í˜„ì¬ ê²½ë¡œ: ${window.location.pathname}`));
            
            // 2. í¬ìŠ¤íŠ¸ ëª©ë¡ í…ŒìŠ¤íŠ¸
            output(outputId, log('\n1. í¬ìŠ¤íŠ¸ ëª©ë¡ API í…ŒìŠ¤íŠ¸...'));
            try {
                const postsResponse = await fetch('/api/blog/posts');
                if (postsResponse.ok) {
                    const postsData = await postsResponse.json();
                    if (postsData.success && postsData.posts && postsData.posts.length > 0) {
                        output(outputId, log(`âœ… í¬ìŠ¤íŠ¸ ${postsData.posts.length}ê°œ ë°œê²¬`, 'success'));
                        
                        // UUID ê²€ì¦
                        const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
                        const validPosts = postsData.posts.filter(post => uuidRegex.test(post.id));
                        
                        if (validPosts.length === postsData.posts.length) {
                            output(outputId, log('âœ… ëª¨ë“  í¬ìŠ¤íŠ¸ IDê°€ ìœ íš¨í•œ UUID í˜•ì‹', 'success'));
                        } else {
                            output(outputId, log(`âš ï¸ ${validPosts.length}/${postsData.posts.length} í¬ìŠ¤íŠ¸ë§Œ ìœ íš¨í•œ UUID`, 'warning'));
                        }
                        
                        // ì²« ë²ˆì§¸ í¬ìŠ¤íŠ¸ë¡œ ìƒì„¸ í…ŒìŠ¤íŠ¸
                        if (validPosts.length > 0) {
                            const firstPost = validPosts[0];
                            output(outputId, log(`\n2. ìƒì„¸ í¬ìŠ¤íŠ¸ API í…ŒìŠ¤íŠ¸ (ID: ${firstPost.id})...`));
                            
                            const detailResponse = await fetch(`/api/blog/posts/${firstPost.id}`);
                            if (detailResponse.ok) {
                                const detailData = await detailResponse.json();
                                if (detailData.success) {
                                    output(outputId, log('âœ… ìƒì„¸ í¬ìŠ¤íŠ¸ API ì •ìƒ ì‘ë™', 'success'));
                                    output(outputId, log(`âœ… í…ŒìŠ¤íŠ¸ ë§í¬: /blog/${firstPost.id}`, 'success'));
                                } else {
                                    output(outputId, log('âŒ ìƒì„¸ í¬ìŠ¤íŠ¸ ë°ì´í„° ì˜¤ë¥˜', 'error'));
                                }
                            } else {
                                output(outputId, log(`âŒ ìƒì„¸ í¬ìŠ¤íŠ¸ API ì‘ë‹µ ì˜¤ë¥˜: ${detailResponse.status}`, 'error'));
                            }
                        }
                    } else {
                        output(outputId, log('âš ï¸ í¬ìŠ¤íŠ¸ê°€ ì—†ê±°ë‚˜ ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜', 'warning'));
                    }
                } else {
                    output(outputId, log(`âŒ í¬ìŠ¤íŠ¸ ëª©ë¡ API ì˜¤ë¥˜: ${postsResponse.status}`, 'error'));
                }
            } catch (error) {
                output(outputId, log(`âŒ í¬ìŠ¤íŠ¸ API ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`, 'error'));
            }
            
            // 3. ì¹´í…Œê³ ë¦¬ í…ŒìŠ¤íŠ¸
            output(outputId, log('\n3. ì¹´í…Œê³ ë¦¬ API í…ŒìŠ¤íŠ¸...'));
            try {
                const categoriesResponse = await fetch('/api/blog/categories');
                if (categoriesResponse.ok) {
                    const categoriesData = await categoriesResponse.json();
                    if (categoriesData.success && categoriesData.categories) {
                        output(outputId, log(`âœ… ì¹´í…Œê³ ë¦¬ ${categoriesData.categories.length}ê°œ ë°œê²¬`, 'success'));
                    } else {
                        output(outputId, log('âš ï¸ ì¹´í…Œê³ ë¦¬ ë°ì´í„° ì—†ìŒ', 'warning'));
                    }
                } else {
                    output(outputId, log(`âŒ ì¹´í…Œê³ ë¦¬ API ì˜¤ë¥˜: ${categoriesResponse.status}`, 'error'));
                }
            } catch (error) {
                output(outputId, log(`âŒ ì¹´í…Œê³ ë¦¬ API ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`, 'error'));
            }
            
            output(outputId, log('\n=== ì§„ë‹¨ ì™„ë£Œ ===', 'info'));
            output(outputId, log('\nğŸ’¡ ë¬¸ì œ í•´ê²° íŒ:', 'info'));
            output(outputId, log('1. í¬ìŠ¤íŠ¸ê°€ ì—†ë‹¤ë©´ Supabaseì—ì„œ blog_posts í…Œì´ë¸”ì— published ìƒíƒœì˜ í¬ìŠ¤íŠ¸ë¥¼ ì¶”ê°€í•˜ì„¸ìš”'));
            output(outputId, log('2. 404 ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤ë©´ ìœ„ì˜ ìœ íš¨í•œ ë§í¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”'));
            output(outputId, log('3. UUID í˜•ì‹ì´ ì•„ë‹Œ IDê°€ ìˆë‹¤ë©´ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ í™•ì¸í•˜ì„¸ìš”'));
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ í¬ìŠ¤íŠ¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        window.onload = function() {
            testPostsList();
        };
    </script>
</body>
</html>
