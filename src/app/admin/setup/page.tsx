'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport styled from 'styled-components';\nimport Link from 'next/link';\n\ninterface DatabaseStatus {\n  success: boolean;\n  tables: string[];\n  counts: {\n    categories: number;\n    posts: number;\n  };\n}\n\nconst SetupPage = () => {\n  const [status, setStatus] = useState<DatabaseStatus | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [initializing, setInitializing] = useState(false);\n\n  useEffect(() => {\n    checkDatabaseStatus();\n  }, []);\n\n  const checkDatabaseStatus = async () => {\n    try {\n      setLoading(true);\n      const response = await fetch('/api/admin/setup');\n      const data = await response.json();\n      setStatus(data);\n    } catch (error) {\n      console.error('ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);\n      setStatus({\n        success: false,\n        tables: [],\n        counts: { categories: 0, posts: 0 }\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const initializeDatabase = async () => {\n    if (!confirm('ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? í•„ìš”í•œ í…Œì´ë¸”ê³¼ ê¸°ë³¸ ë°ì´í„°ê°€ ìƒì„±ë©ë‹ˆë‹¤.')) {\n      return;\n    }\n\n    try {\n      setInitializing(true);\n      const response = await fetch('/api/admin/setup', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n      \n      const data = await response.json();\n      \n      if (data.success) {\n        alert('ë°ì´í„°ë² ì´ìŠ¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');\n        checkDatabaseStatus(); // ìƒíƒœ ì¬í™•ì¸\n      } else {\n        alert('ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì‹¤íŒ¨: ' + data.error);\n      }\n    } catch (error) {\n      console.error('ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì¤‘ ì—ëŸ¬:', error);\n      alert('ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setInitializing(false);\n    }\n  };\n\n  return (\n    <Container>\n      <Header>\n        <h1>ğŸ”§ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •</h1>\n        <Link href=\"/admin/blog\">\n          <BackButton>â† ë¸”ë¡œê·¸ ê´€ë¦¬ë¡œ ëŒì•„ê°€ê¸°</BackButton>\n        </Link>\n      </Header>\n\n      <StatusCard>\n        <h2>ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ</h2>\n        \n        {loading ? (\n          <LoadingText>ìƒíƒœ í™•ì¸ ì¤‘...</LoadingText>\n        ) : (\n          <>\n            <StatusItem>\n              <StatusLabel>ì—°ê²° ìƒíƒœ:</StatusLabel>\n              <StatusValue success={status?.success}>\n                {status?.success ? 'âœ… ì—°ê²°ë¨' : 'âŒ ì—°ê²° ì‹¤íŒ¨'}\n              </StatusValue>\n            </StatusItem>\n\n            <StatusItem>\n              <StatusLabel>í…Œì´ë¸”:</StatusLabel>\n              <StatusValue success={status?.tables.length ? status.tables.length > 0 : false}>\n                {status?.tables.length || 0}ê°œ \n                {status?.tables.length ? `(${status.tables.join(', ')})` : ''}\n              </StatusValue>\n            </StatusItem>\n\n            <StatusItem>\n              <StatusLabel>ì¹´í…Œê³ ë¦¬ ìˆ˜:</StatusLabel>\n              <StatusValue success={true}>\n                {status?.counts.categories || 0}ê°œ\n              </StatusValue>\n            </StatusItem>\n\n            <StatusItem>\n              <StatusLabel>í¬ìŠ¤íŠ¸ ìˆ˜:</StatusLabel>\n              <StatusValue success={true}>\n                {status?.counts.posts || 0}ê°œ\n              </StatusValue>\n            </StatusItem>\n          </>\n        )}\n      </StatusCard>\n\n      <ActionCard>\n        <h2>âš™ï¸ ê´€ë¦¬ ì‘ì—…</h2>\n        \n        <ActionItem>\n          <ActionDescription>\n            <h3>ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”</h3>\n            <p>\n              ë¸”ë¡œê·¸ ìš´ì˜ì— í•„ìš”í•œ í…Œì´ë¸”ë“¤ì„ ìƒì„±í•˜ê³  ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.\n              <br />\n              <strong>í¬í•¨ ì‚¬í•­:</strong> post_categories, posts, post_comments, post_likes í…Œì´ë¸”\n            </p>\n          </ActionDescription>\n          <InitButton \n            onClick={initializeDatabase} \n            disabled={initializing}\n          >\n            {initializing ? 'ì´ˆê¸°í™” ì¤‘...' : 'ğŸš€ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”'}\n          </InitButton>\n        </ActionItem>\n\n        <ActionItem>\n          <ActionDescription>\n            <h3>ìƒíƒœ ìƒˆë¡œê³ ì¹¨</h3>\n            <p>í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœë¥¼ ë‹¤ì‹œ í™•ì¸í•©ë‹ˆë‹¤.</p>\n          </ActionDescription>\n          <RefreshButton \n            onClick={checkDatabaseStatus} \n            disabled={loading}\n          >\n            {loading ? 'í™•ì¸ ì¤‘...' : 'ğŸ”„ ìƒíƒœ ìƒˆë¡œê³ ì¹¨'}\n          </RefreshButton>\n        </ActionItem>\n      </ActionCard>\n\n      <InfoCard>\n        <h2>ğŸ“ ì‚¬ìš© ë°©ë²•</h2>\n        <ol>\n          <li>ë¨¼ì € <strong>\"ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”\"</strong>ë¥¼ í´ë¦­í•˜ì—¬ í•„ìš”í•œ í…Œì´ë¸”ì„ ìƒì„±í•˜ì„¸ìš”.</li>\n          <li>ì´ˆê¸°í™”ê°€ ì™„ë£Œë˜ë©´ ë¸”ë¡œê·¸ ê´€ë¦¬ í˜ì´ì§€ì—ì„œ ì¹´í…Œê³ ë¦¬ì™€ í¬ìŠ¤íŠ¸ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>\n          <li>ë¬¸ì œê°€ ë°œìƒí•˜ë©´ \"ìƒíƒœ ìƒˆë¡œê³ ì¹¨\"ìœ¼ë¡œ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.</li>\n        </ol>\n      </InfoCard>\n    </Container>\n  );\n};\n\n// Styled Components\nconst Container = styled.div`\n  max-width: 800px;\n  margin: 2rem auto;\n  padding: 0 1rem;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 2rem;\n  \n  h1 {\n    margin: 0;\n    color: #333;\n  }\n`;\n\nconst BackButton = styled.button`\n  padding: 0.5rem 1rem;\n  background: #6c757d;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  text-decoration: none;\n  \n  &:hover {\n    background: #5a6268;\n  }\n`;\n\nconst Card = styled.div`\n  background: white;\n  border-radius: 8px;\n  padding: 1.5rem;\n  margin-bottom: 1.5rem;\n  box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n  \n  h2 {\n    margin: 0 0 1rem 0;\n    color: #333;\n  }\n`;\n\nconst StatusCard = styled(Card)``;\nconst ActionCard = styled(Card)``;\nconst InfoCard = styled(Card)``;\n\nconst StatusItem = styled.div`\n  display: flex;\n  justify-content: space-between;\n  padding: 0.5rem 0;\n  border-bottom: 1px solid #eee;\n  \n  &:last-child {\n    border-bottom: none;\n  }\n`;\n\nconst StatusLabel = styled.span`\n  font-weight: 500;\n  color: #555;\n`;\n\nconst StatusValue = styled.span<{ success: boolean }>`\n  color: ${props => props.success ? '#28a745' : '#dc3545'};\n  font-weight: 500;\n`;\n\nconst LoadingText = styled.div`\n  text-align: center;\n  color: #666;\n  padding: 1rem;\n`;\n\nconst ActionItem = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 1rem 0;\n  border-bottom: 1px solid #eee;\n  \n  &:last-child {\n    border-bottom: none;\n  }\n`;\n\nconst ActionDescription = styled.div`\n  flex: 1;\n  margin-right: 1rem;\n  \n  h3 {\n    margin: 0 0 0.5rem 0;\n    color: #333;\n  }\n  \n  p {\n    margin: 0;\n    color: #666;\n    font-size: 0.9rem;\n    line-height: 1.4;\n  }\n`;\n\nconst Button = styled.button`\n  padding: 0.75rem 1.5rem;\n  border: none;\n  border-radius: 4px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n  \n  &:disabled {\n    opacity: 0.6;\n    cursor: not-allowed;\n  }\n`;\n\nconst InitButton = styled(Button)`\n  background: #28a745;\n  color: white;\n  \n  &:hover:not(:disabled) {\n    background: #218838;\n  }\n`;\n\nconst RefreshButton = styled(Button)`\n  background: #007bff;\n  color: white;\n  \n  &:hover:not(:disabled) {\n    background: #0056b3;\n  }\n`;\n\nexport default SetupPage;\n